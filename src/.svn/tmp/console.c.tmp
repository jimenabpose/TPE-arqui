#include "../include/defs.h"
#include "../include/console.h"
#include "../include/string.h"
#include "../include/keyboard.h"

#define	TOPE_FILAS	40
#define	TOPE_COLS	80

int tickpos = 0;


void
printf ( const char *format, ... )
{
	char **arg = (char **) &format;
	int c;
	char buf[20];
	
	_Cli();
	
	arg++;

	while ((c = *format++) != 0)
	{
		if (c != '%')
		{
			printChar(c);
		}
		else
		{
			char *p;
			c = *format++;

			switch (c)
			{
				case 'd':
				case 'u':
				case 'x':
					itoa (buf, c, *((int *) arg++));
					p = buf;
					goto string;
					break;

				case 's':
					p = *arg++;
					if (! p)
						p = "(null)";

				string:
					while (*p)
					printChar (*p++);
					break;

				default:
					printChar (*((int *) arg++));
					break;
			}
		}	
	}
	_Sti();
}

void
printChar( char ascii )
{
	char *video = (char *) 0xb8000;
	
	/* Si es el backspace */
	if(ascii == '\x08')
	{
		video[tickpos]='2';
		tickpos = (tickpos + 2) % (80*40);
	}
	
	/* Si es un enter */
	else if(ascii == '\n')
	{
		print_new_line();
	}
	
	/* Si es un tab */
	else if(ascii == '\t')
	{
		tickpos = (tickpos + 4) % (80*40);
	}
	
	/* Resto de los caracteres */
	
	/*if((ascii >= 0x10 && ascii <= 0x19) || (ascii >= 0x1E && ascii <= 0x26)
			|| (ascii >= 0x2C && ascii <= 0x32))
	{*/
	else {
		video[tickpos]=ascii;
		tickpos = (tickpos + 2) % (80*40);
	}
	/*}	*/
	
	/*write(0, tecl, 1);*/
	
	return;

}

void
print_new_line(){
	int line = (tickpos%80);
	tickpos += line;
}



