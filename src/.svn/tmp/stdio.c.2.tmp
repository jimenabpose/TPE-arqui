#include "../include/defs.h"
#include "../include/video.h"

byte int_80(dword op, byte data, dword offset, dword fd)
{
	if(op == WRITE)
	{
		if (fd == FD_PANTALLA){
			write_screen(data,offset);
			return 0;
		}
	} 
	else if(op == READ)
	{
		if (fd == FD_PANTALLA){
			return read_screen();		
		} 
	}
}

void write(int fd, const void* buffer, int count) {
/*	int i;
	int offset;
	byte data;

	for ( i = 0 ; i<count; i++) {
		offset = i + cursor*2;
		data = *((byte *)buffer+i);

		_call_int_80(WRITE, fd, offset, data);
		buffervideo[offset] = data;

	}
	cursor+=count/2;
*/
}

byte read(int fd, void* buffer, int count) {
	int i;
    
	byte * b = (byte *)buffer;
    	for ( i = 0 ; i<count; i++) {
        	b[i] = _call_int_80(READ, fd, i, 0);
        	if (b[i] == 0xFF) { 
            		break;
        	}
    	}
    
	return i;
}
	


/*
* puts
*
* Escribe el string str en pantalla.
* 
*/
void puts( const char * str ) {
    while (*str) {
        printChar(*str++);
    }
}


/*
* flush
*
* si queda algo en el buffer de put_char, lo imprime
* 
*/
void flush() {
    
   /* if (cursor + vb_counter >= 2000) {

        check_screen_scroll(vb_counter);
        check_offset('9',vb_counter);

        write(PANTALLA_FD, video_buffer, vb_counter);
        vb_counter = 0;
    } else {
        check_offset('4',vb_counter);
        write(PANTALLA_FD, video_buffer, vb_counter);
        vb_counter = 0;
    }*/
}

/*
* se fija si hay q scrollear la pantalla
* 
*/

void check_screen_scroll(int offset) {
    if (cursor + offset >= 2000) {
        page_roll(2000-cursor);
    }
    return;
}


void
garbage()
{
	char c = 'a';
        int i;
        for (i = 0; i<2000; i++)
        {
		printChar(c++%50+'a');
		flush();
	}
}
